@model int

@using (var db = new DatabaseContext())
{
	var filter = db.LogsFilters
		.FirstOrDefault(x => x.Id == Model);

	if (filter == null)
	{
		<div class="error">
			Фильтр <b>№@Model</b> не найден
		</div>
		return;
	}

	var channels = db.Channels
		.ToList();

	var usedChannels = db.Rel_LogFilter_Channel
		.Where(x => x.LogFilterId == filter.Id)
		.Select(x => x.ChannelId)
		.ToList();

	<div class="view-caption">
		<div>
			<b>Редактирование фильтра @filter.Name</b>
		</div>
		<div>
			<button class="button" onclick="modal('#delete')">Удалить</button>
			<button class="button" onclick="go('@Url.Action("", "filters")')">К списку</button>
		</div>
	</div>

	<div class="view-body" id="edit-form" form="@Url.Action("DoEdit", "filters")">
		<input type="hidden" name="@nameof(filter.Id)" value="@filter.Id" />
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Имя</span>
			</div>
			<div>
				<input name="@nameof(filter.Name)" value="@filter.Name" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Описание</span>
			</div>
			<div>
				<textarea name="@nameof(filter.Description)">@filter.Description</textarea>
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Разрешающий</span>
			</div>
			<div>
				<input type="checkbox" name="@nameof(filter.Allow)" @(filter.Allow ? "checked" : "") />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Компьютеры (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.Endpoints)" value="@filter.Endpoints" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Журналы (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.Journals)" value="@filter.Journals" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Источники (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.Sources)" value="@filter.Sources" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Id событий (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.EventIds)" value="@filter.EventIds" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Категории (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.Categories)" value="@filter.Categories" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Типы (через ;)</span>
			</div>
			<div>
				<input name="@nameof(filter.Types)" value="@filter.Types" />
			</div>
		</div>
		<div class="view-form-field">
			<div class="view-form-field-name">
				<span>Каналы оповещения</span>
			</div>
			<div class="view-form-selection">
				<input type="hidden" name="Channels[]" value="0" />
				@foreach (var channel in channels)
				{
					if (usedChannels.Contains(channel.Id))
					{
						<div onclick="changeSelection(this)">
							<input type="hidden" name="Channels[]" value="@channel.Id" />
							@channel.Name
						</div>
					}
					else
					{
						<div onclick="changeSelection(this)" class="excluded">
							<input type="hidden" name="Channels[]" class="excluded" value="@channel.Id" />
							@channel.Name
						</div>
					}
				}
			</div>
		</div>

		<div class="view-form-buttons">
			<button class="button" onclick="submit('#edit-form')">Сохранить</button>
		</div>
	</div>

	<div class="modal-group" id="delete">
		<div class="overlay"></div>
		<div class="modal" id="delete-form" form="@Url.Action("DoDelete", "Filters")">
			<input type="hidden" name="@nameof(filter.Id)" value="@filter.Id" />
			<div>Вы уверены, что хотите удалить этот фильтр?</div>
			<div class="view-form-buttons">
				<button class="button" onclick="submit('#delete-form')">Удалить</button>
				<button class="button" onclick="modal()">Отмена</button>
			</div>
		</div>
	</div>
}
