stages:
  - copy
  - kill
  - build
  - deploy

copy-project:
  stage: copy

  tags:
    - buildopc

  script:
    - xcopy /s .\Datalake\Datalake "C:\app\Datalake" /K /D /H /Y

  only:
    - /^\d+.\d+.\d+$/

kill-previous:
  stage: kill

  tags:
    - buildopc

  script:
    - taskkill /f /im Datalake.exe

build-datalake:
  stage: build

  tags:
    - buildopc

  script:
    - cd C:\app\Datalake
    - msbuild /t:Restore
    - msbuild /t:Build /p:Configuration=Release

  when: always

  only:
    - /^\d+.\d+.\d+$/

deploy-datalake:
  stage: deploy

  tags:
    - buildopc

  when: delayed
  start_in: 1 minutes
    
  script:
    - sc start Datalake
  
  only:
    - /^\d+.\d+.\d+$/
